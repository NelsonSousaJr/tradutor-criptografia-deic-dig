<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>DEIC-DIG — Scan Crypto Interface</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Share+Tech+Mono:wght@400&display=swap');
    
    * { margin:0; padding:0; box-sizing:border-box; }
    
    body {
      font-family: 'Share Tech Mono', 'Courier New', monospace;
      background: #000;
      color: #00ff99;
      min-height: 100vh;
      overflow-x: hidden;
      position: relative;
    }

    /* Fundo cyberpunk com grid e partículas */
    .cyberpunk-bg {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      background: 
        radial-gradient(ellipse at center, #0a0a0a 0%, #000 70%),
        linear-gradient(45deg, rgba(0,255,153,0.02) 0%, transparent 50%, rgba(0,255,153,0.02) 100%);
      z-index: -10;
    }

    .grid-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-image: 
        linear-gradient(rgba(0,255,153,0.03) 1px, transparent 1px),
        linear-gradient(90deg, rgba(0,255,153,0.03) 1px, transparent 1px);
      background-size: 50px 50px;
      animation: grid-pulse 4s ease-in-out infinite;
      z-index: -9;
    }

    @keyframes grid-pulse {
      0%, 100% { opacity: 0.3; }
      50% { opacity: 0.6; }
    }

    /* Partículas flutuantes */
    .particles {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: -8;
    }

    .particle {
      position: absolute;
      width: 2px;
      height: 2px;
      background: #00ff99;
      border-radius: 50%;
      animation: float 8s linear infinite;
      box-shadow: 0 0 6px #00ff99;
    }

    @keyframes float {
      0% { transform: translateY(100vh) translateX(0); opacity: 0; }
      10% { opacity: 1; }
      90% { opacity: 1; }
      100% { transform: translateY(-10vh) translateX(100px); opacity: 0; }
    }

    /* Holographic interface container - SEM BORDA ANIMADA */
    .holo-interface {
      position: relative;
      width: 900px;
      max-width: 95vw;
      margin: 50px auto;
      background: 
        linear-gradient(135deg, rgba(0,255,153,0.05) 0%, rgba(0,255,153,0.02) 100%),
        radial-gradient(ellipse at center, rgba(0,0,0,0.8) 0%, rgba(0,0,0,0.95) 100%);
      border: 1px solid rgba(0,255,153,0.2);
      border-radius: 15px;
      padding: 30px;
      box-shadow: 
        0 0 50px rgba(0,255,153,0.1),
        inset 0 0 50px rgba(0,0,0,0.5);
      backdrop-filter: blur(10px);
      position: relative;
      overflow: hidden;
    }

    .holo-interface::after {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: 
        repeating-linear-gradient(
          90deg,
          transparent,
          transparent 2px,
          rgba(0,255,153,0.02) 2px,
          rgba(0,255,153,0.02) 4px
        );
      pointer-events: none;
      animation: scan-effect 2s linear infinite;
    }

    @keyframes scan-effect {
      0% { transform: translateX(-100%); }
      100% { transform: translateX(100%); }
    }

    /* Header futurista */
    .neural-header {
      text-align: center;
      margin-bottom: 30px;
      position: relative;
    }

    .neural-title {
      font-family: 'Orbitron', sans-serif;
      font-size: 2.5rem;
      font-weight: 900;
      background: linear-gradient(45deg, #00ff99, #00cc77, #00ff99);
      background-size: 200% 200%;
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      animation: gradient-shift 3s ease-in-out infinite;
      text-shadow: 0 0 30px rgba(0,255,153,0.5);
      margin-bottom: 10px;
    }

    @keyframes gradient-shift {
      0%, 100% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
    }

    .neural-subtitle {
      font-size: 0.9rem;
      color: rgba(0,255,153,0.7);
      letter-spacing: 3px;
      text-transform: uppercase;
    }

    /* Terminal principal com efeitos holográficos */
    .cyber-terminal {
      background: 
        linear-gradient(135deg, rgba(0,0,0,0.9) 0%, rgba(10,30,10,0.8) 100%);
      border: 1px solid rgba(0,255,153,0.3);
      border-radius: 10px;
      padding: 25px;
      box-shadow: 
        0 0 30px rgba(0,255,153,0.1),
        inset 0 0 30px rgba(0,0,0,0.8);
      position: relative;
      overflow: hidden;
    }

    .cyber-terminal::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(0,255,153,0.1), transparent);
      animation: terminal-sweep 4s ease-in-out infinite;
    }

    @keyframes terminal-sweep {
      0%, 90% { left: -100%; }
      10%, 80% { left: 100%; }
    }

    /* Status bar futurista */
    .status-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 15px 0;
      border-bottom: 1px solid rgba(0,255,153,0.2);
      margin-bottom: 25px;
    }

    .status-left {
      display: flex;
      align-items: center;
      gap: 15px;
    }

    .neural-indicator {
      width: 12px;
      height: 12px;
      border-radius: 50%;
      background: #00ff99;
      box-shadow: 0 0 10px #00ff99;
      animation: pulse-green 1.5s ease-in-out infinite;
    }

    @keyframes pulse-green {
      0%, 100% { opacity: 1; transform: scale(1); }
      50% { opacity: 0.5; transform: scale(1.2); }
    }

    .system-status {
      font-family: 'Orbitron', sans-serif;
      font-size: 0.8rem;
      color: #00ff99;
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    .status-right {
      font-size: 0.7rem;
      color: rgba(0,255,153,0.6);
      text-align: right;
    }

    /* Layout principal */
    .cyber-grid {
      display: grid;
      grid-template-columns: 1fr 350px;
      gap: 25px;
    }

    /* Labels e inputs futuristas */
    .cyber-label {
      color: rgba(0,255,153,0.9);
      font-size: 0.85rem;
      text-transform: uppercase;
      letter-spacing: 1px;
      margin-bottom: 8px;
      display: block;
      font-family: 'Orbitron', sans-serif;
      font-weight: 400;
    }

    .cyber-input, .cyber-select, .cyber-textarea {
      width: 100%;
      padding: 12px 15px;
      margin-bottom: 20px;
      background: rgba(0,0,0,0.7);
      border: 1px solid rgba(0,255,153,0.3);
      border-radius: 5px;
      color: #00ff99;
      font-family: 'Share Tech Mono', monospace;
      font-size: 14px;
      transition: all 0.3s ease;
      box-shadow: inset 0 2px 5px rgba(0,0,0,0.5);
    }

    .cyber-textarea {
      min-height: 120px;
      resize: vertical;
    }

    .cyber-input:focus, .cyber-select:focus, .cyber-textarea:focus {
      outline: none;
      border-color: #00ff99;
      box-shadow: 
        0 0 15px rgba(0,255,153,0.3),
        inset 0 2px 5px rgba(0,0,0,0.5);
      background: rgba(0,20,0,0.8);
    }

    /* Botões cyberpunk */
    .cyber-btn {
      background: linear-gradient(135deg, rgba(0,255,153,0.1) 0%, rgba(0,200,120,0.1) 100%);
      border: 1px solid rgba(0,255,153,0.5);
      color: #00ff99;
      padding: 10px 15px;
      border-radius: 5px;
      cursor: pointer;
      font-family: 'Share Tech Mono', monospace;
      font-size: 13px;
      text-transform: uppercase;
      letter-spacing: 1px;
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
    }

    .cyber-btn::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(0,255,153,0.2), transparent);
      transition: left 0.5s ease;
    }

    .cyber-btn:hover {
      border-color: #00cc77;
      color: #00cc77;
      box-shadow: 0 0 20px rgba(0,255,153,0.3);
      transform: translateY(-2px);
    }

    .cyber-btn:hover::before {
      left: 100%;
    }

    .cyber-btn:active {
      transform: translateY(0);
    }

    /* Área de controles */
    .control-grid {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      margin: 15px 0;
    }

    .paste-zone {
      border: 2px dashed rgba(0,255,153,0.3);
      padding: 20px;
      text-align: center;
      border-radius: 8px;
      background: rgba(0,0,0,0.3);
      color: rgba(0,255,153,0.7);
      cursor: pointer;
      transition: all 0.3s ease;
      margin: 15px 0;
    }

    .paste-zone:hover {
      border-color: #00ff99;
      background: rgba(0,255,153,0.05);
      color: #00ff99;
    }

    /* Preview de imagem */
    .preview-container {
      margin: 15px 0;
      border: 1px solid rgba(0,255,153,0.2);
      border-radius: 8px;
      padding: 15px;
      background: rgba(0,0,0,0.5);
    }

    .preview-container img {
      max-width: 100%;
      max-height: 200px;
      border-radius: 5px;
      box-shadow: 0 4px 15px rgba(0,0,0,0.5);
    }

    /* Painel lateral */
    .side-panel {
      display: flex;
      flex-direction: column;
      gap: 20px;
    }

    .output-section {
      background: rgba(0,0,0,0.6);
      border: 1px solid rgba(0,255,153,0.3);
      border-radius: 8px;
      padding: 20px;
    }

    .output-wrapper {
      display: flex;
      gap: 10px;
      align-items: flex-start;
    }

    .cyber-output {
      flex: 1;
      height: 200px;
      background: rgba(0,0,0,0.8);
      border: 1px solid rgba(0,255,153,0.2);
      border-radius: 5px;
      padding: 15px;
      color: #00ff99;
      font-family: 'Share Tech Mono', monospace;
      font-size: 14px;
      resize: none;
      overflow-y: auto;
    }

    /* Status e informações */
    .info-panel {
      background: rgba(0,0,0,0.4);
      border: 1px solid rgba(0,255,153,0.2);
      border-radius: 8px;
      padding: 15px;
    }

    .status-text {
      color: rgba(0,255,153,0.8);
      font-size: 12px;
      margin-top: 10px;
      min-height: 1em;
    }

    .confidence-display {
      color: rgba(0,255,153,0.8);
      font-size: 12px;
      font-weight: bold;
    }

    /* Efeitos de glitch ocasionais */
    .glitch-effect {
      animation: glitch 0.3s ease-in-out;
    }

    @keyframes glitch {
      0%, 100% { transform: translate(0); }
      20% { transform: translate(-2px, 2px); }
      40% { transform: translate(-2px, -2px); }
      60% { transform: translate(2px, 2px); }
      80% { transform: translate(2px, -2px); }
    }

    /* Responsividade */
    @media (max-width: 900px) {
      .cyber-grid {
        grid-template-columns: 1fr;
      }
      
      .neural-title {
        font-size: 2rem;
      }
      
      .holo-interface {
        margin: 20px auto;
        padding: 20px;
      }
    }

    /* Efeitos de loading */
    .loading-bar {
      width: 100%;
      height: 2px;
      background: rgba(0,255,153,0.2);
      border-radius: 1px;
      overflow: hidden;
      margin: 10px 0;
    }

    .loading-progress {
      height: 100%;
      background: linear-gradient(90deg, #00ff99, #00cc77);
      width: 0%;
      transition: width 0.3s ease;
      animation: loading-glow 1.5s ease-in-out infinite;
    }

    @keyframes loading-glow {
      0%, 100% { box-shadow: 0 0 5px rgba(0,255,153,0.5); }
      50% { box-shadow: 0 0 20px rgba(0,255,153,0.8); }
    }
  </style>
</head>
<body>
  <div class="cyberpunk-bg"></div>
  <div class="grid-overlay"></div>
  <div class="particles" id="particles"></div>

  <div class="holo-interface">
    <div class="neural-header">
      <h1 class="neural-title">DEIC-DIG</h1>
      <div class="neural-subtitle">Neural Crypto Interface</div>
    </div>

    <div class="cyber-terminal">
      <div class="status-bar">
        <div class="status-left">
          <div class="neural-indicator"></div>
          <div class="system-status">System Online</div>
        </div>
        <div class="status-right">
          <div>SECURE MODE</div>
          <div>v3.0.1 NEURAL</div>
        </div>
      </div>

      <div class="cyber-grid">
        <div class="main-panel">
          <label class="cyber-label">Operação</label>
          <select id="action" class="cyber-select">
            <option value="encrypt">Criptografar</option>
            <option value="decrypt">Descriptografar</option>
          </select>

          <label class="cyber-label">Algoritmo</label>
          <select id="method" class="cyber-select">
            <option value="keyword">Cifra de Palavra-Chave (Vigenère)</option>
          </select>

          <label class="cyber-label">Mensagem</label>
          <textarea id="message" class="cyber-textarea" placeholder="Digite sua mensagem secreta..."></textarea>

          <div class="control-grid">
            <input type="file" id="imageInput" accept="image/*" style="display:none;">
            <button class="cyber-btn" onclick="document.getElementById('imageInput').click()">Upload</button>
            <button id="togglePreviewBtn" class="cyber-btn">Preview</button>
            <button id="clearBtn" class="cyber-btn">Limpar</button>
          </div>

          <div id="pasteArea" class="paste-zone">
            <div>NEURAL SCAN ZONE</div>
            <div style="font-size: 11px; margin-top: 5px;">Cole imagem (CTRL+V) ou arraste aqui</div>
          </div>

          <div id="preview" class="preview-container" style="display: none;"></div>

          <label class="cyber-label">Chave de Criptografia</label>
          <input type="text" id="keyword" class="cyber-input" placeholder="Ex: DEIC">

          <div class="loading-bar" id="loadingBar" style="display: none;">
            <div class="loading-progress" id="loadingProgress"></div>
          </div>

          <div class="status-text" id="ocrStatus"></div>
        </div>

        <div class="side-panel">
          <div class="output-section">
            <label class="cyber-label">Resultado</label>
            <div class="output-wrapper">
              <textarea id="output" class="cyber-output" readonly></textarea>
              <button id="copyBtn" class="cyber-btn">📋</button>
            </div>
            <div style="font-size: 11px; color: rgba(0,255,153,0.6); margin-top: 10px;">
              Use o botão copiar para transferir o resultado
            </div>
          </div>

          <div class="info-panel">
            <label class="cyber-label">Opções</label>
            <div style="display: flex; gap: 10px; margin-bottom: 15px;">
              <button id="generateQR" class="cyber-btn">QR Code</button>
            </div>
            
            <label class="cyber-label">Confiança do Scan</label>
            <div id="ocrConfidence" class="confidence-display">—</div>
            
            <div style="font-size: 10px; color: rgba(0,255,153,0.5); margin-top: 15px;">
              Dica: Imagens com alto contraste aumentam a precisão do reconhecimento de scan neural
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/tesseract.js@4/dist/tesseract.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/qrcode/build/qrcode.min.js"></script>

  <script>
    // Elementos DOM
    const messageInput = document.getElementById('message');
    const keywordInput = document.getElementById('keyword');
    const output = document.getElementById('output');
    const methodSelect = document.getElementById('method');
    const actionSelect = document.getElementById('action');
    const imageInput = document.getElementById('imageInput');
    const pasteArea = document.getElementById('pasteArea');
    const preview = document.getElementById('preview');
    const ocrStatus = document.getElementById('ocrStatus');
    const ocrConfidence = document.getElementById('ocrConfidence');
    const copyBtn = document.getElementById('copyBtn');
    const clearBtn = document.getElementById('clearBtn');
    const togglePreviewBtn = document.getElementById('togglePreviewBtn');
    const generateQR = document.getElementById('generateQR');
    const loadingBar = document.getElementById('loadingBar');
    const loadingProgress = document.getElementById('loadingProgress');

    let worker = null;
    let previewVisible = false;

    // Criar partículas flutuantes
    function createParticles() {
      const particlesContainer = document.getElementById('particles');
      for (let i = 0; i < 20; i++) {
        const particle = document.createElement('div');
        particle.className = 'particle';
        particle.style.left = Math.random() * 100 + '%';
        particle.style.animationDelay = Math.random() * 8 + 's';
        particle.style.animationDuration = (8 + Math.random() * 4) + 's';
        particlesContainer.appendChild(particle);
      }
    }

    // Efeito de glitch ocasional
    function triggerGlitch() {
      const elements = document.querySelectorAll('.cyber-terminal, .neural-title');
      const randomElement = elements[Math.floor(Math.random() * elements.length)];
      randomElement.classList.add('glitch-effect');
      setTimeout(() => {
        randomElement.classList.remove('glitch-effect');
      }, 300);
    }

    // Lógica de criptografia (mantida do original)
    function encryptKeywordCipher(text, keyword) {
      if (!keyword || keyword.trim() === "") return text;
      const cleanKeyword = keyword.toUpperCase().replace(/[^A-Z]/g, "");
      if (cleanKeyword.length === 0) return text;
      let result = "";
      let keywordIndex = 0;
      const charMap = { 'Á':'A','À':'A','Â':'A','Ã':'A','Ä':'A','á':'a','à':'a','â':'a','ã':'a','ä':'a','É':'E','È':'E','Ê':'E','Ë':'E','é':'e','è':'e','ê':'e','ë':'e','Í':'I','Ì':'I','Î':'I','Ï':'I','í':'i','ì':'i','î':'i','ï':'i','Ó':'O','Ò':'O','Ô':'O','Õ':'O','Ö':'O','ó':'o','ò':'o','ô':'o','õ':'o','ö':'o','Ú':'U','Ù':'U','Û':'U','Ü':'U','ú':'u','ù':'u','û':'u','ü':'u','Ç':'C','ç':'c' };
      for (let i = 0; i < text.length; i++) {
        const originalChar = text[i];
        const upperChar = (charMap[originalChar] || originalChar).toUpperCase();
        if (upperChar >= 'A' && upperChar <= 'Z') {
          const tChar = upperChar.charCodeAt(0) - 65;
          const kChar = cleanKeyword.charCodeAt(keywordIndex % cleanKeyword.length) - 65;
          const enc = (tChar + kChar) % 26;
          let newChar = String.fromCharCode(enc + 65);
          if (originalChar === originalChar.toLowerCase()) newChar = newChar.toLowerCase();
          result += newChar;
          keywordIndex++;
        } else {
          result += originalChar;
        }
      }
      return result;
    }

    function decryptKeywordCipher(text, keyword) {
      if (!keyword || keyword.trim() === "") return text;
      const cleanKeyword = keyword.toUpperCase().replace(/[^A-Z]/g, "");
      if (cleanKeyword.length === 0) return text;
      let result = "";
      let keywordIndex = 0;
      for (let i = 0; i < text.length; i++) {
        const originalChar = text[i];
        const upperChar = originalChar.toUpperCase();
        if (upperChar >= 'A' && upperChar <= 'Z') {
          const tChar = upperChar.charCodeAt(0) - 65;
          const kChar = cleanKeyword.charCodeAt(keywordIndex % cleanKeyword.length) - 65;
          const dec = (tChar - kChar + 26) % 26;
          let newChar = String.fromCharCode(dec + 65);
          if (originalChar === originalChar.toLowerCase()) newChar = newChar.toLowerCase();
          result += newChar;
          keywordIndex++;
        } else {
          result += originalChar;
        }
      }
      return result;
    }

    function updateOutput() {
      const method = methodSelect.value;
      const action = actionSelect.value;
      const text = messageInput.value;
      const keyword = keywordInput.value;
      if (!keyword || keyword.trim() === "") {
        output.value = text;
        return;
      }
      if (method === 'keyword') {
        output.value = action === 'encrypt' ? encryptKeywordCipher(text, keyword) : decryptKeywordCipher(text, keyword);
      }
    }

    function showLoading(progress) {
      loadingBar.style.display = 'block';
      loadingProgress.style.width = progress + '%';
      if (progress >= 100) {
        setTimeout(() => {
          loadingBar.style.display = 'none';
        }, 1000);
      }
    }

    function flashStatus(text, isError = false) {
      ocrStatus.textContent = text;
      ocrStatus.style.color = isError ? '#ff6666' : 'rgba(0,255,153,0.8)';
      setTimeout(() => { 
        if (ocrStatus.textContent === text) ocrStatus.textContent = ''; 
      }, 3000);
    }

    // Event listeners
    messageInput.addEventListener('input', updateOutput);
    keywordInput.addEventListener('input', updateOutput);
    methodSelect.addEventListener('change', updateOutput);
    actionSelect.addEventListener('change', updateOutput);

    copyBtn.addEventListener('click', async () => {
      if (output.value.trim() === '') return;
      try {
        await navigator.clipboard.writeText(output.value);
        flashStatus('Dados copiados para o buffer neural');
      } catch (e) {
        flashStatus('Falha na transferência de dados', true);
      }
    });

    clearBtn.addEventListener('click', () => {
      messageInput.value = '';
      keywordInput.value = '';
      output.value = '';
      preview.innerHTML = '';
      preview.style.display = 'none';
      previewVisible = false;
      togglePreviewBtn.textContent = 'Preview';
      ocrStatus.textContent = '';
      ocrConfidence.textContent = '—';
      imageInput.value = '';
      updateOutput();
      flashStatus('Sistema reinicializado');
    });

    togglePreviewBtn.addEventListener('click', () => {
      previewVisible = !previewVisible;
      preview.style.display = previewVisible ? 'block' : 'none';
      togglePreviewBtn.textContent = previewVisible ? 'Ocultar' : 'Preview';
    });

    imageInput.addEventListener('change', (e) => {
      const f = e.target.files[0];
      if (f) processOCR(f);
    });

    // Lógica de colar imagem
    function handlePasteImage(event) {
      const items = (event.clipboardData || window.clipboardData).items;
      for (const item of items) {
        if (item.type.indexOf('image') !== -1) {
          const file = item.getAsFile();
          if(file){
            event.preventDefault();
            processOCR(file);
            return;
          }
        }
      }
    }

    pasteArea.addEventListener('paste', handlePasteImage);
    messageInput.addEventListener('paste', handlePasteImage);

    window.addEventListener('dragover', e => e.preventDefault());
    window.addEventListener('drop', e => {
      e.preventDefault();
      if (e.dataTransfer.files && e.dataTransfer.files.length) {
        processOCR(e.dataTransfer.files[0]);
      }
    });

    // OCR Worker
    async function ensureWorker() {
      if (worker) return worker;
      flashStatus('Inicializando módulo neural...');
      showLoading(20);
      try {
        worker = await Tesseract.createWorker({
          logger: m => {
            if (m.status === 'recognizing text') {
              const p = Math.round(m.progress * 100);
              flashStatus(`Processamento neural: ${p}%`);
              showLoading(20 + (p * 0.8));
            }
          }
        });
        await worker.loadLanguage('por+eng');
        await worker.initialize('por+eng');
        flashStatus('Módulo neural ativo');
        showLoading(100);
        return worker;
      } catch (err) {
        flashStatus('Falha na inicialização neural', true);
        worker = null;
        throw err;
      }
    }

    async function processOCR(file) {
      if (!file) return;
      preview.innerHTML = '';
      flashStatus('Preparando scan neural...');
      ocrConfidence.textContent = '—';

      if (!previewVisible) {
        togglePreviewBtn.click();
      }

      try {
        const wk = await ensureWorker();
        
        const canvas = document.createElement('canvas');
        const ctx = canvas.getContext('2d');
        const img = new Image();
        
        img.onload = async () => {
          canvas.width = img.width;
          canvas.height = img.height;
          ctx.drawImage(img, 0, 0);
          
          const imgEl = document.createElement('img');
          imgEl.src = canvas.toDataURL('image/png');
          preview.innerHTML = '';
          preview.appendChild(imgEl);

          try {
            flashStatus('Executando scan neural...');
            const { data: { text, confidence } } = await wk.recognize(canvas);
            const conf = Math.round(confidence);
            
            if (text && text.trim().length > 0 && conf >= 30) {
              messageInput.value = text.trim();
              messageInput.focus();
              flashStatus('Dados extraídos com sucesso!');
              ocrConfidence.textContent = `${conf}%`;
              updateOutput();
              triggerGlitch(); // Efeito visual de sucesso
            } else {
              flashStatus('Scan neural incompleto', true);
              ocrConfidence.textContent = `Baixa confiança (${conf}%)`;
            }
          } catch (recErr) {
            flashStatus('Erro no processamento de scan neural', true);
            console.error('Recognition error:', recErr);
          }
        };
        
        img.onerror = () => {
          flashStatus('Erro ao carregar imagem', true);
        };
        
        img.src = URL.createObjectURL(file);

      } catch (err) {
        flashStatus('Falha crítica no sistema de scan', true);
        console.error('Error processing OCR:', err);
      }
    }

    generateQR.addEventListener('click', () => {
      const text = output.value.trim();
      if (!text) { 
        flashStatus('Nenhum dado para codificar', true); 
        return; 
      }
      const canvas = document.createElement('canvas');
      QRCode.toCanvas(canvas, text, { 
        margin: 2, 
        scale: 6,
        color: {
          dark: '#00ff99',
          light: '#000000'
        }
      }, (error) => {
        if (error) { 
          flashStatus('Erro na geração do QR Code', true); 
          return; 
        }
        const w = window.open('');
        w.document.write('<html><body style="margin:0; background:#000; display:flex; justify-content:center; align-items:center;"></body></html>');
        w.document.body.appendChild(canvas);
        flashStatus('QR Code gerado');
      });
    });

    // Inicialização
    document.addEventListener('DOMContentLoaded', () => {
      createParticles();
      updateOutput();
      ensureWorker();
      
      // Efeito de glitch ocasional
      setInterval(triggerGlitch, 15000 + Math.random() * 10000);
      
      flashStatus('Sistema de scan neural inicializado');
    });
  </script>
</body>
</html>
